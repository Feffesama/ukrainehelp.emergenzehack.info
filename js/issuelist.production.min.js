$.getJSON("/_data/machgen/issuesjson.json",function(a){renderissues(a.filter(a=>"open"==a.state))});function capitalize_all(a){const b=a.split(" ");return b.map(a=>a[0].toUpperCase()+a.substring(1).toLowerCase()).join(" ")}function shuffleArray(a){return a.sort(()=>Math.random()-.5)}function intersects(a,b){return 0<a.filter(a=>b.includes(a)).length}class IssueCategoriesButtons extends React.Component{render(){var a=this.props.categories,b=this.props.filteredissues,c=[];for(var d in a){var e=a[d],f=b.filter(a=>intersects(JSON.parse(a.issue.labels),e.labelnames)),g=f.length;0<f.length&&c.push(React.createElement("div",{className:"col-12 col-sm-6 mb-15"},React.createElement("a",{href:""+e.permalink,className:"btn btn-primary btn-block text-left h-100",title:"Vedi tutte le segnalazioni della categoria "+e.displayname},React.createElement("span",{className:"fa-stack text-left","aria-label":"logo del marker della segnalazione",role:"img"},React.createElement("i",{className:"fa fa-circle fa-stack-2x","aria-hidden":"true",style:{color:e.markercolor}}),React.createElement("i",{className:"fa fa-"+e.markericon+" fa-stack-1x fa-inverse","aria-hidden":"true"})),React.createElement("span",{className:"text-center"},e.displayname," ",React.createElement("span",{className:"badge badge-pill badge-secondary"},g)))))}return React.createElement(React.Fragment,null,c)}}function issueGetCoords(a){var b=[];return a.issue.data.hasOwnProperty("Posizione")?b=a.issue.data.Posizione.split(" ").map(a=>parseFloat(a)):a.issue.data.hasOwnProperty("address")?a.issue.data.address.hasOwnProperty("address")&&a.issue.data.address.address.hasOwnProperty("lat")&&a.issue.data.address.address.hasOwnProperty("lon")&&(b=[a.issue.data.address.address.lat,a.issue.data.address.address.lon]):a.issue.data.hasOwnProperty("location")&&a.issue.data.location.hasOwnProperty("address")&&a.issue.data.location.address.hasOwnProperty("lat")&&a.issue.data.location.address.hasOwnProperty("lon")&&(b=[parseFloat(a.issue.data.address.address.lat),parseFloat(a.issue.data.address.address.lon)]),b}function issueGetCategory(a,b){for(var c in b){var d=b[c];if(intersects(a,d.labelnames))return d}return null}function IssueData(a){var b=a.issue.issue.data,c=[];for(var d in b){var e;if(e=b[d],d=capitalize_all(d),!issueFieldsBlacklist.includes(d))if(c.push(React.createElement("dt",{className:"col-sm-3"},d)),"Address"==d){var f=[];if(e.hasOwnProperty("address")){var g=e.address;if(g.hasOwnProperty("address")){var h=g.address;h.hasOwnProperty("city")&&f.push(React.createElement(React.Fragment,null,React.createElement("dt",{className:"col-sm-3"},"City"),React.createElement("dd",{className:"col-sm-9"},h.city))),h.hasOwnProperty("country")&&f.push(React.createElement(React.Fragment,null,React.createElement("dt",{className:"col-sm-3"},"Country"),React.createElement("dd",{className:"col-sm-9"},h.country)))}}c.push(React.createElement("dd",{className:"col-sm-9"},React.createElement("dl",{className:"row"},f)))}else if("Location"==d){var f=[];if(e.hasOwnProperty("address")){var g=e.address;if(g.hasOwnProperty("address")){var h=g.address;h.hasOwnProperty("city")&&f.push(React.createElement(React.Fragment,null,React.createElement("dt",{className:"col-sm-3"},"City"),React.createElement("dd",{className:"col-sm-9"},h.city))),h.hasOwnProperty("country")&&f.push(React.createElement(React.Fragment,null,React.createElement("dt",{className:"col-sm-3"},"Country"),React.createElement("dd",{className:"col-sm-9"},h.country)))}}c.push(React.createElement("dd",{className:"col-sm-9"},React.createElement("dl",{className:"row"},f)))}else if("Description"==d){c.push(React.createElement("dd",{className:"col-sm-9"},React.createElement(Linkify,null,e.trim())))}else c.push(React.createElement("dd",{className:"col-sm-9"},e.trim()))}return React.createElement(React.Fragment,null,c)}class IssueSocialShare extends React.Component{render(){var a=this.props.issue,b=siteurl+"/issues/"+a.number+"&title="+a.title.slice(0,70)+"%20%7C%20"+sitetitle;return React.createElement(React.Fragment,null,React.createElement("a",{className:"card-link fa-stack",href:siteurl+"/issues/"+a.number,title:"Copia link"},React.createElement("i",{className:"fas fa-circle fa-stack-2x","aria-hidden":"true"}),React.createElement("span",{className:"fas fa-link fa-stack-1x fa-inverse","aria-hidden":"true"})),React.createElement("a",{className:"card-link fa-stack",href:"https://www.facebook.com/sharer/sharer.php?u="+b,title:"Share on Facebook",target:"_blank"},React.createElement("i",{className:"fa fa-circle fa-stack-2x","aria-hidden":"true"}),React.createElement("i",{className:"fa fa-facebook fa-stack-1x fa-inverse","aria-hidden":"true"})),React.createElement("a",{className:"card-link fa-stack",href:"https://twitter.com/intent/tweet?text="+b+"&via=europehelp&hashtags=europehelp",title:"Share on Twitter",target:"_blank"},React.createElement("i",{className:"fa fa-circle fa-stack-2x","aria-hidden":"true"}),React.createElement("i",{className:"fa fa-twitter fa-stack-1x fa-inverse","aria-hidden":"true"})),React.createElement("a",{className:"card-link fa-stack",href:"https://www.linkedin.com/shareArticle?mini=true&url="+b,title:"Share on LinkedIn",target:"_blank"},React.createElement("i",{className:"fa fa-circle fa-stack-2x","aria-hidden":"true"}),React.createElement("i",{className:"fa fa-linkedin fa-stack-1x fa-inverse","aria-hidden":"true"})))}}class IssueMiniMap extends React.Component{componentDidMount(){var a=this.props.issue,b=this.props.category,c=this.coords;if(0<c.length){var d=L.AwesomeMarkers.icon({icon:"",markerColor:"darkpurple"}),e=L.map("map"+a.number+b.displayname,{scrollWheelZoom:!1}),f=sitetilemap,g=new L.TileLayer(f,{minZoom:5,maxZoom:19,attribution:"&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, Tiles courtesy of <a href=\"http://hot.openstreetmap.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a>"}),h=L.markerClusterGroup(),i=parseFloat(c[0]),j=parseFloat(c[1]),k=a.title,l=a.number,m=a.issue.labels,n=d;if(n=L.AwesomeMarkers.icon({icon:b.markericon,markerColor:b.markercolor,prefix:"fa"}),!isNaN(i)&&!isNaN(j)){var o=new L.LatLng(i,j),p=new L.Marker(o,{icon:n});h.addLayer(p),p.bindPopup("<a href=\"/issues/"+l+"\">"+decodeURI(k)+"</a>")}e.addLayer(h),e.addLayer(g).setView([0,0],9),e.fitBounds(h.getBounds().pad(10)),e.setZoom(12)}}render(){var a=this.props.issue,b=this.props.category,c=issueGetCoords(a);return this.coords=c,0<this.coords.length?React.createElement(React.Fragment,null," ",React.createElement("dt",{className:"col-sm-3"},"Map")," ",React.createElement("dd",{className:"col-sm-9"},React.createElement("div",{id:"map"+a.number+b.displayname,className:"w-100",style:{height:"200px"}}))," "):null}}class IssueCard extends React.Component{render(){var a=this.props.issue,b=this.props.category,c=React.createElement("div",{className:"card",id:"issue"+a.number},React.createElement("div",{className:"card-body issuepanel"},React.createElement("a",{href:"/issues/"+a.number},React.createElement("h4",{className:"card-title"},a.title)),React.createElement("dl",{className:"row"},React.createElement(IssueData,{issue:a}),React.createElement(IssueMiniMap,{issue:a,category:b})),React.createElement("div",{className:"card-footer"},React.createElement("b",null,"Share:")," ",React.createElement(IssueSocialShare,{issue:a}))));return React.createElement("div",{className:"col-md-12 col-sm-12 col-12 mb-15"},c," ")}}class IssueCardList extends React.Component{render(){var a=this.props.issues,b=this.props.category,c=a.map(function(a){return React.createElement(IssueCard,{issue:a,category:b})});return React.createElement("div",{className:"col-md-12 col-sm-12 col-12 mb-15"},c," ")}}class IssueCategoriesList extends React.Component{render(){var a=this.props.categories,b=this.props.filteredissues,c=[];for(var d in a){var e=a[d],f=b.filter(a=>intersects(JSON.parse(a.issue.labels),e.labelnames)),g=f.length;f=shuffleArray(f),0<maxIssuesForCategory&&(f=f.slice(0,maxIssuesForCategory)),0<f.length&&(c.push(React.createElement(React.Fragment,null,React.createElement("h2",{id:""+e.permalink},e.displayname,React.createElement("span",{className:"badge badge-pill badge-primary"},g)),React.createElement(IssueCardList,{issues:f,category:e}))),0<maxIssuesForCategory&&g>maxIssuesForCategory&&c.push(React.createElement("div",{className:"row"},React.createElement("div",{className:"col-12 col-lg-12 col-md-12"},React.createElement("a",{href:""+e.permalink,title:"Vedi tutte le segnalazioni della categoria"+e.displayname,className:"btn btn-primary btn-lg"},"See all ",e.displayname)),React.createElement("hr",{className:"col-12 col-lg-12 col-md-12"}))))}return React.createElement("div",null,c)}}class IssueFullMap extends React.Component{componentDidMount(){var a=this.props.filteredissues,b=this.props.categories,c=L.AwesomeMarkers.icon({icon:"",markerColor:"darkpurple"}),d=L.map("mapAll",{scrollWheelZoom:!1}),e=sitetilemap,f=new L.TileLayer(e,{minZoom:5,maxZoom:19,attribution:"&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, Tiles courtesy of <a href=\"http://hot.openstreetmap.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a>"});d.addLayer(f).setView([0,0],9);var g=L.markerClusterGroup();a.map(a=>{var d=issueGetCoords(a);if(0<d.length){var e=parseFloat(d[0]),f=parseFloat(d[1]),h=a.title,i=a.number,j=JSON.parse(a.issue.labels),k=c,l=issueGetCategory(j,b);if(l&&(k=L.AwesomeMarkers.icon({icon:l.markericon,markerColor:l.markercolor,prefix:"fa"}),!isNaN(e)&&!isNaN(f))){var m=new L.LatLng(e,f),n=new L.Marker(m,{icon:k});n.bindPopup("<a href=\"/issues/"+i+"\">"+decodeURI(h)+"</a>"),g.addLayer(n)}}}),d.addLayer(g),d.fitBounds(g.getBounds().pad(.3))}render(){var a=this.props.filteredissues;return this.filteredissues=a,React.createElement("div",{className:"col-md-12 col-sm-12 col-12"}," ",React.createElement("div",{id:"mapAll",className:"w-100",style:{height:"600px"}})," ")}}function renderissues(a){ReactDOM.render(React.createElement(IssueCategoriesButtons,{categories:issueCategories,filteredissues:a}),document.getElementById("issuebuttons")),ReactDOM.render(React.createElement(IssueCategoriesList,{categories:issueCategories,filteredissues:a}),document.getElementById("issue-card")),ReactDOM.render(React.createElement(IssueFullMap,{categories:issueCategories,filteredissues:a}),document.getElementById("issuemap"))}